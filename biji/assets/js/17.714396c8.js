(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{539:function(t,s,a){t.exports=a.p+"assets/img/4.6eee9f0c.png"},540:function(t,s,a){t.exports=a.p+"assets/img/5.c05342fd.png"},541:function(t,s,a){t.exports=a.p+"assets/img/6.6e703c07.png"},542:function(t,s,a){t.exports=a.p+"assets/img/7.fe812899.png"},612:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"gitlab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab","aria-hidden":"true"}},[t._v("#")]),t._v(" gitlab")]),t._v(" "),e("blockquote",[e("p",[t._v("私有 gitlab 仓库环境搭建, "),e("a",{attrs:{href:"https://about.gitlab.com/install/#centos-7",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文献"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v("安装使用GitLab需要至少4GB可用内存(RAM + Swap)! 由于操作系统和其他正在运行的应用也会使用内存, 所以安装GitLab前一定要注意当前服务器至少有4GB的可用内存. 少于4GB内存会导致在reconfigure的时候出现各种诡异的问题, 而且在使用过程中也经常会出现500错误")])]),t._v(" "),e("h2",{attrs:{id:"环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境准备","aria-hidden":"true"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("安装基础依赖")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装技术依赖")]),t._v("\nsudo yum install "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y curl policycoreutils"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("python openssh"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动ssh服务&设置为开机启动")]),t._v("\nsudo systemctl enable sshd\nsudo systemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" sshd\n")])])])]),t._v(" "),e("li",[e("p",[t._v("安装 Postfix")]),t._v(" "),e("p",[t._v("Postfix是一个邮件服务器，GitLab发送邮件需要用到")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装postfix")]),t._v("\nsudo yum install "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y postfix\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动postfix并设置为开机启动")]),t._v("\nsudo systemctl enable postfix\nsudo systemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" postfix\n")])])])]),t._v(" "),e("li",[e("p",[t._v("开放ssh以及http服务（80端口）")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开放ssh、http服务")]),t._v("\nsudo firewall"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cmd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service=ssh "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("permanent\nsudo firewall"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cmd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service=http "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("permanent\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重载防火墙规则")]),t._v("\nsudo firewall"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cmd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("reload\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"安装-gitlab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-gitlab","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装 GitLab")]),t._v(" "),e("blockquote",[e("p",[t._v("我们部署的是社区版")])]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Yum安装GitLab,添加GitLab社区版Package")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("curl https:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("packages"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("install"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repositories"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" sudo bash\n")])])])]),t._v(" "),e("li",[e("p",[t._v("安装GitLab社区版")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("sudo yum install "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce\n")])])])]),t._v(" "),e("li",[e("p",[t._v("配置GitLab站点Url")]),t._v(" "),e("blockquote",[e("p",[t._v("GitLab默认的配置文件路径是 "),e("code",[t._v("/etc/gitlab/gitlab.rb")]),t._v("，我们来更改它，（大约在第15行）")])]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认的站点Url配置项是")]),t._v("\nexternal_url "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://gitlab.example.com'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里我将GitLab站点Url修改为http://gitlab.dxf2016.cn,在域名解析里面把你的gitlab服务器IP加进去。")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以用IP代替域名，这里根据自己需求来即可 ")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("启动并访问GitLab")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("sudo gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ctl reconfigure\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 完成后将会看到如下输出")]),t._v("\nRunning handlers complete\nChef Client finished"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 432"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("613 resources updated in 03 minutes 43 seconds\ngitlab Reconfigured"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("访问GitLab")]),t._v(" "),e("p",[t._v("将设置的域名DNS解析到服务器IP，或者修改本地host将域名指向服务器IP\n访问 "),e("code",[t._v("http://gitlab.dxf2016.cn")])])]),t._v(" "),e("li",[e("p",[t._v("设置管理员密码")]),t._v(" "),e("blockquote",[e("p",[t._v("这时候会提示为管理员账号设置密码。管理员账号默认username是root。设置完成之后即可使用root账号登录，登陆后会进入欢迎界面\n"),e("img",{attrs:{src:a(539),alt:"gitlab"}})])])])]),t._v(" "),e("h2",{attrs:{id:"gitlab-postfix发送邮件邮箱设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-postfix发送邮件邮箱设置","aria-hidden":"true"}},[t._v("#")]),t._v(" GitLab Postfix发送邮件邮箱设置")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("确定postfix是启动状态")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("systemctl status postfix\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出现下面Active: active (running)说明postFix已经启动成功了")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ● postfix.service - Postfix Mail Transport Agent")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Loaded: loaded (/usr/lib/systemd/system/postfix.service; enabled; vendor preset: disabled)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Active: active (running) since Thu 2019-01-17 10:24:03 CST; 1 day 1h ago")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("vim打开gitlab的配置文件： "),e("code",[t._v("/etc/gitlab/gitlab.rb")]),t._v(" ，新增以下内容,就是配置发送邮件的原邮箱")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("gitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_enable'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = true\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_address'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"smtp.qq.com"')]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_port'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = 465  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# （注意，不要用25端口）")]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_user_name'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10627xxx@qq.com"')]),t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你自己QQ邮箱地址")]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_password'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*************"')]),t._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# QQ授权码")]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_domain'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"smtp.qq.com"')]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"login"')]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_enable_starttls_auto'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = true\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'smtp_tls'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = true\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_email_from'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10627xxx@qq.com'")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 你自己QQ邮箱地址")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("QQ授权码哪里来？打开QQ邮箱-设置-账户-帐户安全-开启服务-POP3/SMTP服务-生成授权码-发个短信")]),t._v(" "),e("p",[e("img",{attrs:{src:a(540),alt:"5.png"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(541),alt:"6.png"}})])]),t._v(" "),e("li",[e("p",[t._v("配置完成后执行gitlab-ctl reconfigure 让配置生效")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ctl reconfigure\n")])])])]),t._v(" "),e("li",[e("p",[t._v("当你进入用root账号gitlab之后，创建一个新的账号的时候，会通过"),e("code",[t._v("10627xxx@qq.com")]),t._v(" 你配置的邮箱账号给新创建的邮箱账号发送邮件")]),t._v(" "),e("p",[e("img",{attrs:{src:a(542),alt:"7.png"}})])])]),t._v(" "),e("h2",{attrs:{id:"gitlab常用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab常用配置","aria-hidden":"true"}},[t._v("#")]),t._v(" GitLab常用配置")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("禁用创建组权限")]),t._v(" "),e("p",[t._v("GitLab默认所有的注册用户都可以创建组。但对于团队来说，通常只会给Leader相关权限。虽然可以在用户管理界面取消权限，但毕竟不方便。我们可以通过配置GitLab默认禁用创建组权限。")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改配置文件")]),t._v("\nsudo vi "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启gitlab_rails['gitlab_default_can_create_group'] 选项，并将值设置为false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### GitLab user privileges")]),t._v("\ngitlab_rails"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_default_can_create_group'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" = false\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#保存后，重新配置并启动GitLab")]),t._v("\nsudo gitlab"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ctl reconfigure\n")])])])]),t._v(" "),e("li",[e("p",[t._v("gitlab-ctl常用命令介绍")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("命令")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("check-config")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("检查在gitlab中是否有任何配置。在指定版本中删除的rb")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("deploy-page")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("安装部署页面")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("diff-config")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("将用户配置与包可用配置进行比较")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("remove-accounts")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("删除所有用户和组")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("upgrade")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("升级")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("service-list")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("查看所有服务")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("once")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("如果GitLab服务停止了就启动服务，如果已启动就不做任何操作")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("restart")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("重启GitLab服务")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("start")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("如果GitLab服务停止了就启动服务，如果已启动就重启服务")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("stop")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("停止GitLab服务")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("status")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("查看GitLab服务状态")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("reconfigure")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("reconfigure重新配置GitLab并启动")])])])])])]),t._v(" "),e("h2",{attrs:{id:"gitlab-nginx冲突解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-nginx冲突解决","aria-hidden":"true"}},[t._v("#")]),t._v(" GitLab nginx冲突解决")]),t._v(" "),e("p",[t._v("你安装gitlab的时候，gitlab自带内置nginx，如果你自己安装了nginx，会与你的nginx产生冲突，那么我们该怎么办呢！")]),t._v(" "),e("h3",{attrs:{id:"禁用gitlab自带nginx-并把-unix套接字-更改为-tcp端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#禁用gitlab自带nginx-并把-unix套接字-更改为-tcp端口","aria-hidden":"true"}},[t._v("#")]),t._v(" 禁用gitlab自带Nginx 并把 UNIX套接字 更改为 TCP端口")]),t._v(" "),e("ol",[e("li",[t._v("禁用捆绑的Nginx, "),e("code",[t._v("vim /etc/gitlab/gitlab.rb")])])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'enable'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 改为 nginx['enable'] = false, 并将前面的 # 去掉")]),t._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("允许gitlab-workhorse监听TCP（默认端口8181）, "),e("code",[t._v("vim /etc/gitlab/gitlab.rb")])])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("gitlab_workhorse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listen_network'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tcp"')]),t._v("\ngitlab_workhorse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listen_addr'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:8181"')]),t._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[e("p",[t._v("运行"),e("code",[t._v("sudo gitlab-ctl reconf")]),t._v(" 使更改生效")])]),t._v(" "),e("li",[e("p",[t._v("通过系统原本安装的Nginx反代以便提供访问")])])]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("vim "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("default"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#你的conf配置文件")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 增加这一项")]),t._v("\nlocation "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root  html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    index index"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_pass http:"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("127"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1:8181"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最后重启一下nginx  =>  systemctl restart nginx")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);