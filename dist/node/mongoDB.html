<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | 前端笔记</title>
    <meta name="description" content="Welcome to my VuePress site">
    <link rel="icon" href="/assets/images/F_1.png">
    
    <link rel="preload" href="/assets/css/0.styles.92bf089a.css" as="style"><link rel="preload" href="/assets/js/app.260082ab.js" as="script"><link rel="preload" href="/assets/js/2.abe796d4.js" as="script"><link rel="preload" href="/assets/js/13.92e9db98.js" as="script"><link rel="prefetch" href="/assets/js/10.9dabb9bd.js"><link rel="prefetch" href="/assets/js/11.04035704.js"><link rel="prefetch" href="/assets/js/12.e14b5709.js"><link rel="prefetch" href="/assets/js/14.d32119f6.js"><link rel="prefetch" href="/assets/js/15.b13a1f1f.js"><link rel="prefetch" href="/assets/js/16.bcfbc81c.js"><link rel="prefetch" href="/assets/js/17.3d0adf24.js"><link rel="prefetch" href="/assets/js/18.4db57ccc.js"><link rel="prefetch" href="/assets/js/19.824583e5.js"><link rel="prefetch" href="/assets/js/20.5a1c82f0.js"><link rel="prefetch" href="/assets/js/21.d73d9897.js"><link rel="prefetch" href="/assets/js/22.d4e79057.js"><link rel="prefetch" href="/assets/js/23.3543db86.js"><link rel="prefetch" href="/assets/js/24.3f2eb633.js"><link rel="prefetch" href="/assets/js/25.9972ea34.js"><link rel="prefetch" href="/assets/js/26.d0eca9ed.js"><link rel="prefetch" href="/assets/js/27.45e32bd3.js"><link rel="prefetch" href="/assets/js/28.915e2ce3.js"><link rel="prefetch" href="/assets/js/29.a284cff2.js"><link rel="prefetch" href="/assets/js/3.a1169938.js"><link rel="prefetch" href="/assets/js/30.10f563a6.js"><link rel="prefetch" href="/assets/js/31.42548ff5.js"><link rel="prefetch" href="/assets/js/32.27478723.js"><link rel="prefetch" href="/assets/js/33.0154ac26.js"><link rel="prefetch" href="/assets/js/34.0e3d4729.js"><link rel="prefetch" href="/assets/js/35.d26159f8.js"><link rel="prefetch" href="/assets/js/36.54f8be42.js"><link rel="prefetch" href="/assets/js/37.bd0afcd3.js"><link rel="prefetch" href="/assets/js/38.991db0ba.js"><link rel="prefetch" href="/assets/js/39.35285429.js"><link rel="prefetch" href="/assets/js/4.59d9b613.js"><link rel="prefetch" href="/assets/js/40.85e29937.js"><link rel="prefetch" href="/assets/js/41.387737d6.js"><link rel="prefetch" href="/assets/js/42.66c03d2d.js"><link rel="prefetch" href="/assets/js/43.74c52532.js"><link rel="prefetch" href="/assets/js/44.43a2384f.js"><link rel="prefetch" href="/assets/js/45.e1fc99da.js"><link rel="prefetch" href="/assets/js/46.a680b675.js"><link rel="prefetch" href="/assets/js/47.081c6beb.js"><link rel="prefetch" href="/assets/js/48.093db127.js"><link rel="prefetch" href="/assets/js/49.051b2e12.js"><link rel="prefetch" href="/assets/js/5.f573f0ae.js"><link rel="prefetch" href="/assets/js/50.3760412c.js"><link rel="prefetch" href="/assets/js/51.1c230dfd.js"><link rel="prefetch" href="/assets/js/52.84c4fc59.js"><link rel="prefetch" href="/assets/js/6.0c2501b3.js"><link rel="prefetch" href="/assets/js/7.b9517656.js"><link rel="prefetch" href="/assets/js/8.d39559a9.js"><link rel="prefetch" href="/assets/js/9.c4986c38.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92bf089a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/images/F_1.png" alt="前端笔记" class="logo"> <span class="site-name can-hide">前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home/base.html" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/PE/nginx.html" class="nav-link">PE</a></li><li class="dropdown-item"><!----> <a href="/vue/dataBinding.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/flutter/base.html" class="nav-link">flutter</a></li><li class="dropdown-item"><!----> <a href="/node/koa2.html" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/rules/eslint.html" class="nav-link">代码规范</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="国际化" class="dropdown-title"><span class="title">国际化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">国际化?不存在的😂</a></li></ul></div></div><div class="nav-item"><a href="/leaveMessage/base.html" class="nav-link">留言</a></div> <a href="https://github.com/duanxiongfei-2016/notes.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home/base.html" class="nav-link">指南</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/PE/nginx.html" class="nav-link">PE</a></li><li class="dropdown-item"><!----> <a href="/vue/dataBinding.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/flutter/base.html" class="nav-link">flutter</a></li><li class="dropdown-item"><!----> <a href="/node/koa2.html" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/rules/eslint.html" class="nav-link">代码规范</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="国际化" class="dropdown-title"><span class="title">国际化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">国际化?不存在的😂</a></li></ul></div></div><div class="nav-item"><a href="/leaveMessage/base.html" class="nav-link">留言</a></div> <a href="https://github.com/duanxiongfei-2016/notes.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/node/koa2.html" class="sidebar-link">Koa2</a></li><li><a href="/node/mongoDB.html" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/mongoDB.html#mongodb-介绍" class="sidebar-link">MongoDB 介绍</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#官网链接" class="sidebar-link">官网链接</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/mongoDB.html#mac安装" class="sidebar-link">mac安装</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#服务器centeros安装" class="sidebar-link">服务器CenterOS安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#mongoose" class="sidebar-link">mongoose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/mongoDB.html#安装mongoose" class="sidebar-link">安装mongoose</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#引入mongoose并连接mongodb" class="sidebar-link">引入mongoose并连接mongodb</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#schema" class="sidebar-link">schema</a></li><li class="sidebar-sub-header"><a href="/node/mongoDB.html#schema自定义模式修饰符-setters-getters" class="sidebar-link">schema自定义模式修饰符 Setters &amp; Getters</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a> MongoDB</h1> <h2 id="mongodb-介绍"><a href="#mongodb-介绍" aria-hidden="true" class="header-anchor">#</a> MongoDB 介绍</h2> <blockquote><p>MongoDB是一个用json（bson）格式存储的数据库</p></blockquote> <h2 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h2> <blockquote><p>一个mangoDB有可以放多个数据库</p> <p>数据库里面有数据表（这里叫做集合）</p> <p>数据表里面又有很多键值对，也就是真正的数据（这里叫文档，json格式的）</p> <p>这里存储的json格式数据叫做bson（json的子集）</p></blockquote> <h2 id="官网链接"><a href="#官网链接" aria-hidden="true" class="header-anchor">#</a> 官网链接</h2> <ul><li><a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">英文官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.mongodb.com/cn" target="_blank" rel="noopener noreferrer">中文官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener noreferrer">菜鸟教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.itying.com/category-79-b0-min0-max0-attr0-2-sort_order-DESC.html" target="_blank" rel="noopener noreferrer">视频教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <h3 id="mac安装"><a href="#mac安装" aria-hidden="true" class="header-anchor">#</a> mac安装</h3> <ol><li>安装MongoDB有三种方式：（1）手动命令安装（2）采用Homebrew（3）下载安装包,下面教程是第三种方式安装
<a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <p><img src="/assets/img/1.616065a9.png" alt="下载地址"></p> <ol start="2"><li>将下载下来的.tgz文件解压后的文件夹改名为mongodb,然后打开终端，进入<code>cd /usr/local</code>目录，然后<code>open .</code>打开文件夹，将刚刚解压改名的mongodb文件夹copy到local目录中</li></ol> <p><img src="/assets/img/2.cd2c95a2.png" alt="下载地址"></p> <p><img src="/assets/img/3.ad3440ee.png" alt="下载地址"></p> <ol start="3"><li>配置环境变量，打开终端，输入<code>open ~/.bash_profile</code>，在打开的文件中加入</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>export PATH=$<span class="token punctuation">{</span>PATH<span class="token punctuation">}</span>:<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>mongodb<span class="token operator">/</span>bin
</code></pre></div><p><img src="/assets/img/4.fef08c61.png" alt="下载地址"></p> <ol start="4"><li>保存之后，重启一下bash_profile使之环境变量生效</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>source ~<span class="token operator">/</span><span class="token punctuation">.</span>bash_profile
</code></pre></div><ol start="5"><li>验证是否安装成功，<code>mongod -version</code>回车后如果看到下面的版本号则说明MongoDB已经成功安装到了Mac上</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>mongod <span class="token operator">-</span>version
</code></pre></div><p><img src="/assets/img/5.e8f444fa.png" alt="下载地址"></p> <h3 id="服务器centeros安装"><a href="#服务器centeros安装" aria-hidden="true" class="header-anchor">#</a> 服务器CenterOS安装</h3> <ol><li>配置MongoDB的yum源</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>vim <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>mongodb<span class="token operator">-</span>org<span class="token operator">-</span>4<span class="token punctuation">.</span>0<span class="token punctuation">.</span>repo
<span class="token comment"># 添加以下配置</span>
<span class="token namespace">[mongodb-org-4.0]</span>
name=MongoDB Repository
baseurl=https:<span class="token operator">/</span><span class="token operator">/</span>repo<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>org<span class="token operator">/</span>yum<span class="token operator">/</span>redhat<span class="token operator">/</span><span class="token variable">$releasever</span><span class="token operator">/</span>mongodb<span class="token operator">-</span>org<span class="token operator">/</span>4<span class="token punctuation">.</span>0<span class="token operator">/</span>x86_64<span class="token operator">/</span>
gpgcheck=1
enabled=1
gpgkey=https:<span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>org<span class="token operator">/</span>static<span class="token operator">/</span>pgp<span class="token operator">/</span>server<span class="token operator">-</span>4<span class="token punctuation">.</span>0<span class="token punctuation">.</span>asc
</code></pre></div><ol start="2"><li>安装MongoDB</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>yum <span class="token operator">-</span>y install mongodb<span class="token operator">-</span>org
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">提示</p> <p>mongodb-org将自动安装以下四个组件包</p> <ol><li><code>mongodb-org-server</code>：包含mongod守护程序，关联的init脚本和配置文件（<code>/etc/mongod.conf</code>）。您可以使用初始化脚本从mongod 配置文件开始。默认情况下<code>/etc/mongod.conf</code>，程序包提供的配置文件已bind_ip设置为127.0.0.1。在初始化副本集之前，根据您的环境需要修改此设置</li> <li><code>mongodb-org-mongos</code>：包含mongos守护进程</li> <li><code>mongodb-org-shell</code>：包含mongoshell</li> <li><code>mongodb-org-tools</code>：一些扩展</li></ol></div> <ol start="3"><li>检查是否安装成功</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>mongod <span class="token operator">-</span>version  <span class="token comment">#  出现db version v4.0.12说明已经安装成功</span>
</code></pre></div><ol start="4"><li>启动MongoDB数据库</li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code>systemctl <span class="token function">start</span> mongod   <span class="token comment"># 启动</span>
systemctl restart mongod <span class="token comment"># 重启</span>
systemctl stop mongod    <span class="token comment"># 关闭</span>
</code></pre></div><ol start="5"><li>mongod.conf的配置，文件路径为<code>/etc/mongod.conf</code></li></ol> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># mongod.conf</span>

<span class="token comment"># for documentation of all options, see:</span>
<span class="token comment">#   http://docs.mongodb.org/manual/reference/configuration-options/</span>

<span class="token comment"># where to write logging data.</span>
systemLog:
  destination: file
  logAppend: true
  path: <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>mongodb<span class="token operator">/</span>mongod<span class="token punctuation">.</span>log  <span class="token comment"># mongod的日志存放文件路径</span>

<span class="token comment"># Where and how to store data.</span>
storage:
  dbPath: <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mongo      <span class="token comment"># mongod的数据存放文路径</span>
  journal:
    enabled: true
<span class="token comment">#  engine:</span>
<span class="token comment">#  mmapv1:</span>
<span class="token comment">#  wiredTiger:</span>

<span class="token comment"># how the process runs</span>
processManagement:
  fork: true  <span class="token comment"># fork and run in background 是否后台启动</span>
  pidFilePath: <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>mongodb<span class="token operator">/</span>mongod<span class="token punctuation">.</span>pid  <span class="token comment"># location of pidfile</span>
  timeZoneInfo: <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>zoneinfo

<span class="token comment"># network interfaces</span>
net:
  port: 27017 <span class="token comment"># 数据库启动端口，建议不要改，一般都是默认27017</span>
  bindIpAll: true <span class="token comment"># bindIpAll和下面的bindIp是互斥的，就是说两者不能同时存在，默认是bindIp: 127.0.0.1</span>
  <span class="token comment"># bindIp: 127.0.0.1  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span>

security:
  authorization: enabled <span class="token comment"># 打开auth认证  使用用户名密码验证</span>

<span class="token comment">#operationProfiling:</span>

<span class="token comment">#replication:</span>

<span class="token comment">#sharding:</span>

<span class="token comment">## Enterprise-Only Options</span>

<span class="token comment">#auditLog:</span>

<span class="token comment">#snmp:</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">提示</p> <p>这是我的mongod.conf配置
在这里重点解释一下30，31这两行的配置，bindIpAll和bindIp是互斥的，也就是说两者不能同时存在，默认是bindIp: 127.0.0.1，没有bindIpAll: true，如果是bindIp: 127.0.0.1，那么只能通过本机访问数据库，做了ip访问限制，外网及navicat等等图形化工具是无法连接mongod数据库的。如果是bindIpAll: true，那么公网都是可以访问的</p> <p>再解释一下33, 34这两行, authorizatio默认是disabled,不开启用户密码认证，公网任何人都可以访问的，进来之后show dbs可以看到所有的数据库，如果配置了authorization: enabled，打开认证的话，进来之后show dbs会发现不会出现所有数据库了，因为设置了账户权限，要想正常访问，需要使用账户名和密码进去
<code>mongo admin -u 用户名 -p 密码</code>即可，如果是访问远程数据库呢，命令如下<code>mongo 192.168.1.200:27017/&lt;test&gt; -u &lt;user&gt; -p &lt;password&gt;</code>,其中&lt;test&gt;数据库名称， &lt;user&gt;用户账号， &lt;password&gt;用户密码</p></div> <ol start="6"><li>MongoDB配置用户名密码权限</li></ol> <p>在服务器上通过<code>mongo</code>命令，直接进入到mongoshell中，然后<code>show dbs</code>会出现三个默认的库admin config local，</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>&gt; show dbs
admin   0<span class="token punctuation">.</span>000GB
config  0<span class="token punctuation">.</span>000GB
local   0<span class="token punctuation">.</span>000GB
&gt; use admin   <span class="token comment"># 进入到admin这个库中</span>
switched to db admin
&gt; show collections <span class="token comment"># 或者也可以用 show tables 查看当前admin库里面有哪些表</span>
system<span class="token punctuation">.</span>users
system<span class="token punctuation">.</span>version
users
&gt; db<span class="token punctuation">.</span>createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token function">pwd</span>:<span class="token string">&quot;admin123&quot;</span><span class="token punctuation">,</span>roles:<span class="token punctuation">[</span><span class="token punctuation">{</span>role:<span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> db:<span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># 创建超级管理员 ,可以登陆操作全部的数据库</span>
Successfully added user: <span class="token punctuation">{</span>
	<span class="token string">&quot;user&quot;</span> : <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;roles&quot;</span> : <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token string">&quot;role&quot;</span> : <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;db&quot;</span> : <span class="token string">&quot;admin&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
&gt; db<span class="token punctuation">.</span>createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token function">pwd</span>:<span class="token string">&quot;admin123&quot;</span><span class="token punctuation">,</span>roles:<span class="token punctuation">[</span><span class="token punctuation">{</span>role:<span class="token string">&quot;userAdminAnyDatabase&quot;</span><span class="token punctuation">,</span>db:<span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 创建用户角色管理员 ,可以添加用户</span>
Successfully added user: <span class="token punctuation">{</span>
	<span class="token string">&quot;user&quot;</span> : <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;roles&quot;</span> : <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token string">&quot;role&quot;</span> : <span class="token string">&quot;userAdminAnyDatabase&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;db&quot;</span> : <span class="token string">&quot;admin&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
&gt; use weChat <span class="token comment"># 创建一个名字叫做weChat数据库</span>
&gt; show dbs
admin   0<span class="token punctuation">.</span>000GB
config  0<span class="token punctuation">.</span>000GB
local   0<span class="token punctuation">.</span>000GB
weChat  0<span class="token punctuation">.</span>000GB <span class="token comment"># 此时已成功创建名字为weChat这个数据库了</span>
&gt; db<span class="token punctuation">.</span>createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token function">pwd</span>: <span class="token string">'test123'</span><span class="token punctuation">,</span> roles: <span class="token punctuation">[</span><span class="token punctuation">{</span>role: <span class="token string">'readWrite'</span><span class="token punctuation">,</span> db: <span class="token string">'weChat'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 创建一个普通用户，对weChat数据库只有读写权限</span>
&gt; db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>users<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span>: <span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 删除test用户</span>
</code></pre></div><p>然后你就可以通过 <code>mongo 192.168.1.200:27017/weChat -u test -p test123</code> 这样连接数据库</p> <h4 id="具体用户权限"><a href="#具体用户权限" aria-hidden="true" class="header-anchor">#</a> 具体用户权限</h4> <ul><li><p><strong>read</strong>：允许用户读取指定数据库</p></li> <li><p><strong>readWrite</strong>：允许用户读写指定数据库</p></li> <li><p><strong>dbAdmin</strong>：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</p></li> <li><p><strong>userAdmin</strong>：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</p></li> <li><p><strong>clusterAdmin</strong>：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</p></li> <li><p><strong>readAnyDatabase</strong>：只在admin数据库中可用，赋予用户所有数据库的读权限</p></li> <li><p><strong>readWriteAnyDatabase</strong>：只在admin数据库中可用，赋予用户所有数据库的读写权限</p></li> <li><p><strong>userAdminAnyDatabase</strong>：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</p></li> <li><p><strong>dbAdminAnyDatabase</strong>：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</p></li> <li><p><strong>root</strong>：只在admin数据库中可用。超级账号，超级权限。</p></li> <li><p>配置成功之后，公网可以通过账号密码访问数据了</p></li></ul> <ol start="7"><li>MongoDB图形化工具</li></ol> <p><a href="https://robomongo.org/download" target="_blank" rel="noopener noreferrer">官方推荐工具 Robo 3T<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.navicat.com.cn/download/navicat-for-mongodb" target="_blank" rel="noopener noreferrer">navicat<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol start="8"><li>navicat连接mongodb数据库后</li></ol> <p><img src="/assets/img/6.945afc69.jpg" alt="6.jpg"></p> <h2 id="mongoose"><a href="#mongoose" aria-hidden="true" class="header-anchor">#</a> mongoose</h2> <h3 id="安装mongoose"><a href="#安装mongoose" aria-hidden="true" class="header-anchor">#</a> 安装mongoose</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code>  npm i mongoose <span class="token operator">-</span>s
</code></pre></div><h3 id="引入mongoose并连接mongodb"><a href="#引入mongoose并连接mongodb" aria-hidden="true" class="header-anchor">#</a> 引入mongoose并连接mongodb</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 连接数据库格式</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://[ip]:[port]/[dataBase]'</span><span class="token punctuation">)</span>
<span class="token comment">// 示例</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://132.232.36.133:27017/test'</span><span class="token punctuation">)</span>
</code></pre></div><p>如果数据库配置了账户密码</p> <div class="language-js extra-class"><pre class="language-js"><code>mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://admin:admin123@localhost:27017/test'</span><span class="token punctuation">)</span>
<span class="token comment">// 也可以这么连接</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
    pass<span class="token punctuation">:</span> <span class="token string">'admin123'</span><span class="token punctuation">,</span>
    useNewUrlParser<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="schema"><a href="#schema" aria-hidden="true" class="header-anchor">#</a> schema</h3> <ul><li><p><a href="http://www.mongoosejs.net/docs/schematypes.html" target="_blank" rel="noopener noreferrer">schema模型文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>什么是schema?schema可以理解为数据库对象的集合，schema是mongoose会用到的一种数据模型，也就是表结构的定义。每一个schema会映射到mongodb  中的一个collection，数据模型 数据结构，例如最简单的一个schema { name: String, age: Number, pwd: String }</p></li> <li><p>举个注册接口的schema，这里面可以对每一个字段进行校验(mongoose自带的 <strong>预定修饰符</strong>)，包括字段的类型，是否必填，正则校验等等...</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> RegisterSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  phone<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'phone is required'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    trim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">5</span><span class="token operator">|</span><span class="token number">6</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">8</span><span class="token operator">|</span><span class="token number">9</span><span class="token punctuation">)</span>\d<span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">}</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">message</span><span class="token punctuation">:</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a valid phone number!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'email is required'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    trim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">A</span><span class="token operator">-</span>Za<span class="token operator">-</span>z0<span class="token operator">-</span><span class="token number">9</span>_\<span class="token operator">-</span>\<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>\@<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">A</span><span class="token operator">-</span>Za<span class="token operator">-</span>z0<span class="token operator">-</span><span class="token number">9</span>_\<span class="token operator">-</span>\<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">A</span><span class="token operator">-</span>Za<span class="token operator">-</span>z<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">message</span><span class="token punctuation">:</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a valid email!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minlength<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    maxlength<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    trim<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  RegisterModel<span class="token punctuation">:</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> RegisterSchema<span class="token punctuation">)</span>
  <span class="token comment">// 注意这里的User, 默认操作的是users表，因为mongodb默认会将所有的表名字后面都加一个`s`</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用schema数据模型，对mongodb进行 增删改查</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Model <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./model'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> RegisterModel <span class="token punctuation">}</span> <span class="token operator">=</span> Model
<span class="token comment">// -------------------------- 分割线 增加数据 --------------------------</span>
<span class="token comment">// 首先先要实例化model</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegisterModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  phone<span class="token punctuation">:</span> <span class="token string">'13811112222'</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token string">'123456@163.com'</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">'qwer123'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 注意：操作数据库增删改查都是异步的操作</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// -------------------------- 分割线 查询数据 --------------------------</span>
<span class="token comment">// 查找多条符合条件的数据 Model.find([conditions], [callback]) conditions查找条件， callback回调函数 Model.find({age: 18}, callback)</span>
<span class="token comment">// 查找一条符合条件的数据 modModelel.findOne(conditions, [callback]) conditions查找条件， callback回调函数 Model.findOne({username:'admin'}, callback)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  RegisterModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// -------------------------- 分割线 更新数据 --------------------------</span>
<span class="token comment">// 根据条件更新所有 Model.update(conditions, doc ,[options], [callback])</span>
<span class="token comment">// 根据指定条件更新一个 Model.findOneAndUpdate([conditions], [update], [options], [callback])</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  RegisterModel<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userName<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>password<span class="token punctuation">:</span> <span class="token string">'admin23'</span><span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// -------------------------- 分割线 删除数据 --------------------------</span>
<span class="token comment">// Model.remove(conditions, [callback])</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  RegisterModel<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userName<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="schema自定义模式修饰符-setters-getters"><a href="#schema自定义模式修饰符-setters-getters" aria-hidden="true" class="header-anchor">#</a> schema自定义模式修饰符 Setters &amp; Getters</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Setters 比如说：有一个url字段，将该字段如果有 `http://` 则保持现状，如果没有则添加` http://`</span>
url<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'url is required'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  trim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  在这里params可以获取url字段的值，返回的数据就是url在数据库中实际保存的值</span>
    <span class="token comment">// 例如：前端传入的字段是www.baidu.com, 我们经过处理自动转换为 http://www.baidu.com并存入数据库中</span>
    <span class="token keyword">const</span> <span class="token constant">REG</span> <span class="token operator">=</span> <span class="token regex">/^http:\/\//</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">REG</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> params
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Getters 一般没什么卵用</span>
<span class="token keyword">const</span> PhoneSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  phone<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'phone is required'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    trim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">4</span><span class="token operator">|</span><span class="token number">5</span><span class="token operator">|</span><span class="token number">6</span><span class="token operator">|</span><span class="token number">7</span><span class="token operator">|</span><span class="token number">8</span><span class="token operator">|</span><span class="token number">9</span><span class="token punctuation">)</span>\d<span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">}</span>$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">message</span><span class="token punctuation">:</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not a valid phone number!</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">+86</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> PhoneModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Phone'</span><span class="token punctuation">,</span> PhoneSchema<span class="token punctuation">,</span> <span class="token string">'phones'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhoneModel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  phone<span class="token punctuation">:</span> <span class="token string">'13811112222'</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token string">'123456@163.com'</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">'qwer123'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>phone<span class="token punctuation">)</span> <span class="token comment">// +8613811112222</span>
</code></pre></div><!----></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/duanxiongfei-2016/notes.git/edit/master/node/mongoDB.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">41 分钟前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/node/koa2.html" class="prev">Koa2</a></span> <!----></p></div> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2dcanvas" width="135" height="300" class="live2dcanvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.260082ab.js" defer></script><script src="/assets/js/2.abe796d4.js" defer></script><script src="/assets/js/13.92e9db98.js" defer></script>
  </body>
</html>
